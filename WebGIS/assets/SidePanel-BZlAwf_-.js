import{_ as O,r as o,w as Y,c as r,b as l,d as e,e as j,f as S,v as x,g as Q,t as w,h as X,F as W,i as B,n as C,j as Z,k as ee,l as te,m as se,p as ae,q as ne,s as oe}from"./index-BwUZL4pR.js";const le={class:"chat-container"},ie={class:"chat-header"},re={class:"header-controls"},ce={key:0,class:"settings-panel"},de={class:"form-group"},ue={class:"form-group"},ve={class:"form-group"},me=["disabled"],he=["value"],pe={class:"hint"},ge={class:"message-content"},fe={key:0,class:"message assistant"},_e={key:2,class:"chat-footer"},be=["onKeydown"],ye=["disabled"],ke={__name:"ChatPanelContent",emits:["close-chat"],setup(E,{emit:N}){const u=o(!1),i=o(""),_=o(!1),m=o(null),h=o(!1),c=o([{id:"deepseek-ai/DeepSeek-V2.5",name:"DeepSeek V2.5 (é»˜è®¤)"}]),b=o("ç‚¹å‡»ğŸ”„å¯è·å–æ›´å¤šæ¨¡å‹"),y="https://api.siliconflow.cn/v1/chat/completions",p="sk-cieoxpimltrmqybxfnqqkrafetvfvxspmpvycggvxsmkboul",A="deepseek-ai/DeepSeek-V2.5",a=o(localStorage.getItem("llm_endpoint_v3")||y),n=o(localStorage.getItem("llm_apikey_v3")||p),v=o(localStorage.getItem("llm_model_v3")||A),g=o([]),D=()=>n.value?{role:"assistant",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ"}:{role:"assistant",content:`æ‚¨å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹ã€‚

âš ï¸ æ³¨æ„ï¼šå°šæœªé…ç½® API Keyã€‚
è¯·ç‚¹å‡»å³ä¸Šè§’ âš™ï¸ è®¾ç½®æ‚¨çš„ API Key åå¼€å§‹ä½¿ç”¨ã€‚`};g.value=[D()],Y([a,n,v],()=>{localStorage.setItem("llm_endpoint_v3",a.value),localStorage.setItem("llm_apikey_v3",n.value),localStorage.setItem("llm_model_v3",v.value)});const T=()=>{te(()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)})},F=()=>{confirm("ç¡®å®šè¦æ¸…é™¤èŠå¤©å†å²å—ï¼Ÿ")&&(g.value=[D()])},q=async()=>{if(!n.value){b.value="âŒ è¯·å…ˆå¡«å†™ API Key";return}h.value=!0,b.value="æ­£åœ¨è·å–æ¨¡å‹åˆ—è¡¨...";try{const t=`${a.value.replace(/\/chat\/completions$/,"")}/models`,s=await fetch(t,{method:"GET",headers:{Authorization:`Bearer ${n.value}`}});if(!s.ok)throw new Error(`HTTP ${s.status}`);const f=await s.json();if(f.data&&Array.isArray(f.data))c.value=f.data.filter(d=>d.id).map(d=>({id:d.id,name:d.name||d.id})),b.value=`âœ… å·²åŠ è½½ ${c.value.length} ä¸ªæ¨¡å‹`,!c.value.some(d=>d.id===v.value)&&c.value.length>0&&(v.value=c.value[0].id);else throw new Error("è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸")}catch(k){b.value=`âŒ è·å–å¤±è´¥: ${k.message}`,console.error("è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥:",k)}finally{h.value=!1}},M=async()=>{var s,f,d;if(!i.value.trim()||_.value)return;const k=i.value.trim();g.value.push({role:"user",content:k}),i.value="",_.value=!0,T();const t=g.value.push({role:"assistant",content:""})-1;try{if(!n.value)throw new Error("è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® API Key");const $=await fetch(a.value,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.value}`},body:JSON.stringify({model:v.value,messages:[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„WebGISå¼€å‘åŠ©æ‰‹ï¼Œç²¾é€šVue3, OpenLayers, Cesiumç­‰æŠ€æœ¯ï¼Œå°†è¢«æˆ‘åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œè¯·ä½ ç»™æˆ‘çš„ç½‘é¡µä½¿ç”¨è€…æä¾›å¸®åŠ©ã€‚è¯·ç”¨ç®€æ´æ˜äº†çš„è¯­è¨€å›ç­”ç”¨æˆ·é—®é¢˜ã€‚ä½ å°†è¢«æˆ‘åœ¨WebGISçš„éƒ¨ç½²ä¸­è°ƒç”¨ï¼Œæˆ‘ï¼ˆå¼€å‘è€…ï¼‰çš„ä¿¡æ¯å¦‚ä¸‹ï¼šNEGIAO,GISä¸“ä¸šï¼›æˆ‘çš„è”ç³»æ–¹å¼æ˜¯ï¼š1482918576@qq.comï¼›è¯·åŸºäºè¿™äº›ä¿¡æ¯æä¾›å¯¹ç”¨æˆ·æœ‰é’ˆå¯¹æ€§çš„å¸®åŠ©ã€‚æ³¨æ„ï¼Œæ¥ä¸‹æ¥çš„å¯¹è¯éƒ½æ˜¯ç”¨æˆ·å‘èµ·çš„ï¼š"},...g.value.slice(0,-1).map(I=>({role:I.role,content:I.content}))],stream:!0})});if(!$.ok){const I=await $.json();throw new Error(((s=I.error)==null?void 0:s.message)||"è¯·æ±‚å¤±è´¥")}const H=$.body.getReader(),G=new TextDecoder("utf-8");let P=!1,L="";for(;!P;){const{value:I,done:z}=await H.read();if(P=z,I){const J=G.decode(I,{stream:!0}).split(`
`);for(const U of J)if(U.trim().startsWith("data: ")){const K=U.trim().substring(6);if(K==="[DONE]")break;try{const R=((d=(f=JSON.parse(K).choices[0])==null?void 0:f.delta)==null?void 0:d.content)||"";L+=R,g.value[t].content=L,T()}catch(V){console.warn("Parse error",V)}}}}}catch($){g.value[t].content=`å‡ºé”™å•¦: ${$.message}`}finally{_.value=!1,T()}};return(k,t)=>(l(),r("div",le,[e("div",ie,[t[7]||(t[7]=e("span",{class:"chat-title"},"ğŸ¤– AI åŠ©æ‰‹",-1)),e("div",re,[e("button",{onClick:F,class:"icon-btn",title:"æ¸…é™¤å†å²"},"ğŸ§¹"),e("button",{onClick:t[0]||(t[0]=s=>u.value=!u.value),class:"icon-btn",title:"è®¾ç½®"},"âš™ï¸"),e("button",{onClick:t[1]||(t[1]=s=>k.$emit("close-chat")),class:"icon-btn",title:"é€€å‡ºAI"},"âœ–ï¸")])]),u.value?(l(),r("div",ce,[e("div",de,[t[8]||(t[8]=e("label",null,"API Endpoint:",-1)),S(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value=s),placeholder:"https://api.deepseek.com/chat/completions"},null,512),[[x,a.value]])]),e("div",ue,[t[9]||(t[9]=e("label",null,"API Key:",-1)),S(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value=s),type:"password",placeholder:"sk-..."},null,512),[[x,n.value]])]),e("div",ve,[e("label",null,[t[10]||(t[10]=Q("Model: ")),e("button",{onClick:q,class:"refresh-btn",disabled:h.value,title:"åˆ·æ–°æ¨¡å‹åˆ—è¡¨"},w(h.value?"â³":"ğŸ”„"),9,me)]),S(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>v.value=s),class:"model-select"},[(l(!0),r(W,null,B(c.value,s=>(l(),r("option",{key:s.id,value:s.id},w(s.name||s.id),9,he))),128))],512),[[X,v.value]]),e("small",pe,w(b.value),1)]),e("button",{onClick:t[5]||(t[5]=s=>u.value=!1),class:"save-btn"},"ä¿å­˜å¹¶è¿”å›")])):(l(),r("div",{key:1,class:"chat-body",ref_key:"chatBody",ref:m},[(l(!0),r(W,null,B(g.value,(s,f)=>(l(),r("div",{key:f,class:C(["message",s.role])},[e("div",ge,w(s.content),1)],2))),128)),_.value?(l(),r("div",fe,t[11]||(t[11]=[e("div",{class:"message-content typing"},"æ­£åœ¨æ€è€ƒ...",-1)]))):j("",!0)],512)),u.value?j("",!0):(l(),r("div",_e,[S(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>i.value=s),onKeydown:Z(ee(M,["prevent"]),["enter"]),placeholder:"è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...",rows:"1"},null,40,be),[[x,i.value]]),e("button",{onClick:M,disabled:_.value||!i.value.trim()},"å‘é€",8,ye)]))]))}},Ie=O(ke,[["__scopeId","data-v-0482d8eb"]]),we=["title"],$e={class:"handle-icon"},Se={key:1,class:"info-content"},Ee={class:"panel-header"},Ae=["src"],Te={class:"title-wrapper"},xe=["href"],Ce={class:"news-header"},Ne=["href","target"],De={class:"image-container"},Me=["src","alt"],Pe=["innerHTML"],Le={class:"panel-footer"},Ue=["href"],Ke={__name:"SidePanel",props:{locationInfo:{type:Object,default:()=>({isInDihuan:!1,lonLat:[0,0]})},selectedImage:{type:String,default:""},activeTab:{type:String,default:"info"}},emits:["news-changed","toggle-panel","close-chat"],setup(E,{emit:N}){const u={MAIN_NEWS:"https://cep.henu.edu.cn/zhxw/xyxw.htm"},i=E,_=N,m="./",h=a=>`${m.endsWith("/")?m:`${m}/`}${a}`,c=[{title:"4.22åœ°çƒæ—¥ï¼Œåœ°ç¯é™¢å¼€å±•ç³»åˆ—æ´»åŠ¨",text:"æ˜¥é£æ‹‚ç»¿é‡ï¼Œä¸‡ç‰©ç«èŠ³åã€‚åœ¨ç¬¬56ä¸ªä¸–ç•Œåœ°çƒæ—¥æ¥ä¸´ä¹‹é™…ï¼Œ4æœˆ21æ—¥ä¸Šåˆï¼Œç”±æ²³å—å¤§å­¦ç›¸å…³å•ä½ä¸»åŠï¼Œåœ¨é‡‘æ˜æ ¡åŒºé©¬å¯å¹¿åœºä¸¾è¡Œã€‚å­¦æ ¡ç›¸å…³èŒèƒ½éƒ¨é—¨é¢†å¯¼ï¼Œåœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨å§”å‘˜ï¼Œåœ°ç†ç§‘å­¦å­¦é™¢å…¨ä½“ç­å­æˆå‘˜å’Œå¸ˆç”Ÿä»£è¡¨...",image:"images/åœ°çƒæ—¥æ´»åŠ¨.jpg",href:"https://cep.henu.edu.cn/info/1022/13421.htm"},{title:"åœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨é¦–å±Šå¤§ä¼šå¬å¼€",text:"2025å¹´2æœˆ23æ—¥ï¼Œæ²³å—å¤§å­¦åœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨é¦–å±Šå¤§ä¼šåœ¨æ²³å—å¤§å­¦é‡‘æ˜æ ¡åŒºé”¥å½¢æŠ¥å‘Šå…é¡ºåˆ©å¬å¼€ã€‚ä¸­å›½å·¥ç¨‹é™¢é™¢å£«ã€ç©ºé—´åŸºå‡†å…¨å›½é‡ç‚¹å®éªŒå®¤å­¦æœ¯å¸¦å¤´äººç‹å®¶è€€ç­‰èŒèƒ½éƒ¨é—¨æœ‰å…³é¢†å¯¼...",image:"images/å­¦éƒ¨å¤§ä¼š.png",href:"https://cep.henu.edu.cn/info/1022/12491.htm"},{title:"2023çº§æœ¬ç§‘ç”Ÿå¹´çº§å¤§ä¼šå¬å¼€",text:"ä¸ºåŠ©åŠ›æˆ‘é™¢2023çº§æœ¬ç§‘ç”Ÿå˜æ¸…å­¦æœ¯åŸ¹å…»è·¯å¾„ï¼Œç³»ç»Ÿæå‡ç§‘ç ”ç´ å…»ä¸å®‰å…¨é˜²èŒƒèƒ½åŠ›ï¼Œæ ‘ç«‹ç§‘å­¦çš„å­¦æœ¯å‘å±•ä¸èŒä¸šè§„åˆ’æ„è¯†ï¼Œ5æœˆ29æ—¥ä¸‹åˆï¼Œæˆ‘é™¢äºé‡‘æ˜æ ¡åŒºç»¼åˆæ•™å­¦æ¥¼2306æ•™å®¤å¬å¼€...",image:"images/å¹´çº§å¤§ä¼š.jpg",href:"https://cep.henu.edu.cn/info/1022/14001.htm"}],b={title:"åœ°ç§‘é™¢æ–°é—»",text:"è¯·å°†é¼ æ ‡ç§»åŠ¨åˆ°åœ°ç§‘é™¢åŒºåŸŸ<br>æŸ¥çœ‹æ–°é—»å†…å®¹<br><br>åœ¨å·¦ä¾§åœ°å›¾ä¸­æ”¾å¤§<br>å¯ä»¥æŸ¥çœ‹åœ°ç§‘é™¢çš„ç…§ç‰‡ï¼<br><br>ä¸‹æ–¹è¿˜æœ‰å†…å®¹å“¦ï¼<br>è¯·é¼ æ ‡ä¸‹æ»‘",image:"images/é™¢å¾½.png",href:u.MAIN_NEWS,isExternal:!0},y=o(0),p=se(()=>{if(!i.locationInfo.isInDihuan)return{...b,image:i.selectedImage||h(c[y.value].image)};const a=c[y.value];return{title:a.title,text:a.text,image:i.selectedImage||h(a.image),href:a.href,isExternal:!0}});function A(){y.value=(y.value+1)%c.length,_("news-changed",y.value)}return(a,n)=>(l(),r("div",{class:C(["info-panel",{collapsed:a.isCollapsed,"in-dihuan":i.locationInfo.isInDihuan}])},[e("div",{class:"toggle-handle",onClick:n[0]||(n[0]=v=>a.$emit("toggle-panel")),title:a.isCollapsed?"å±•å¼€é¢æ¿":"æ”¶èµ·é¢æ¿"},[e("span",$e,w(a.isCollapsed?"â—€":"â–¶"),1)],8,we),S(e("div",{class:C(["panel-content",{"no-padding":E.activeTab==="chat"}])},[E.activeTab==="chat"?(l(),ne(Ie,{key:0,onCloseChat:n[1]||(n[1]=v=>a.$emit("close-chat"))})):(l(),r("div",Se,[e("div",Ee,[e("img",{src:h("images/é™¢å¾½.png"),class:"logo",alt:"æ²³å—å¤§å­¦åœ°ç†ç§‘å­¦å­¦é™¢Logo"},null,8,Ae),e("div",Te,[e("a",{href:u.MAIN_NEWS,target:"_blank",class:"main-title"},"åœ°ç§‘é™¢æ–°é—»",8,xe)])]),e("div",Ce,[e("a",{href:p.value.href,target:p.value.isExternal?"_blank":"_self"},w(p.value.title),9,Ne)]),e("div",De,[e("img",{src:p.value.image,class:"news-image",alt:p.value.title},null,8,Me)]),e("div",{class:"text-content",innerHTML:p.value.text},null,8,Pe),e("button",{class:"action-button",onClick:A,title:"åˆ‡æ¢ä¸‹ä¸€æ¡æ–°é—»"}," ç‚¹å‡»ï¼Œæ–°é—»++ "),oe(a.$slots,"extra-content",{},void 0),e("div",Le,[e("a",{href:u.MAIN_NEWS,target:"_blank"},"æ²³å—å¤§å­¦åœ°ç†ç§‘å­¦å­¦é™¢ï¼",8,Ue)])]))],2),[[ae,!a.isCollapsed]])],2))}},We=O(Ke,[["__scopeId","data-v-c85be94d"]]);export{We as default};
