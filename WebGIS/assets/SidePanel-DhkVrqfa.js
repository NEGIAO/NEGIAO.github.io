import{_ as j,r as v,w as K,c as m,b as r,d as e,e as D,f as b,v as w,F as O,g as U,n as S,t as $,h as z,i as H,j as q,k as F,l as J,m as G,p as R}from"./index-DI6LEzWQ.js";const Q={class:"chat-container"},X={class:"chat-header"},Y={class:"header-controls"},Z={key:0,class:"settings-panel"},ee={class:"form-group"},te={class:"form-group"},se={class:"form-group"},ne={class:"message-content"},ae={key:0,class:"message assistant"},oe={key:2,class:"chat-footer"},le=["onKeydown"],ie=["disabled"],re={__name:"ChatPanelContent",emits:["close-chat"],setup(y,{emit:C}){const c=v(!1),o=v(""),h=v(!1),p=v(null),d=v(localStorage.getItem("llm_endpoint_v3")||"https://api.siliconflow.cn/v1/chat/completions"),l=v(localStorage.getItem("llm_apikey_v3")||"sk-rjdyktuhvtwoirqjzgwxfxbbwykymtgyloqduqkuotakdaxb"),g=v(localStorage.getItem("llm_model_v3")||"deepseek-ai/DeepSeek-V2.5"),a=v([{role:"assistant",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ"}]);K([d,l,g],()=>{localStorage.setItem("llm_endpoint_v3",d.value),localStorage.setItem("llm_apikey_v3",l.value),localStorage.setItem("llm_model_v3",g.value)});const i=()=>{q(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},I=()=>{confirm("ç¡®å®šè¦æ¸…é™¤èŠå¤©å†å²å—ï¼Ÿ")&&(a.value=[{role:"assistant",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ"}])},s=async()=>{var n,k,x;if(!o.value.trim()||h.value)return;const u=o.value.trim();a.value.push({role:"user",content:u}),o.value="",h.value=!0,i();const t=a.value.push({role:"assistant",content:""})-1;try{if(!l.value)throw new Error("è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® API Key");const _=await fetch(d.value,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.value}`},body:JSON.stringify({model:g.value,messages:[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„WebGISå¼€å‘åŠ©æ‰‹ï¼Œç²¾é€šVue3, OpenLayers, Cesiumç­‰æŠ€æœ¯ã€‚è¯·ç”¨ç®€æ´æ˜äº†çš„è¯­è¨€å›ç­”ç”¨æˆ·é—®é¢˜ã€‚å¦‚æœæ¶‰åŠä»£ç ï¼Œè¯·å°½é‡æä¾›å®Œæ•´çš„ä»£ç ç‰‡æ®µã€‚"},...a.value.slice(0,-1).map(f=>({role:f.role,content:f.content}))],stream:!0})});if(!_.ok){const f=await _.json();throw new Error(((n=f.error)==null?void 0:n.message)||"è¯·æ±‚å¤±è´¥")}const L=_.body.getReader(),P=new TextDecoder("utf-8");let N=!1,E="";for(;!N;){const{value:f,done:B}=await L.read();if(N=B,f){const V=P.decode(f,{stream:!0}).split(`
`);for(const T of V)if(T.trim().startsWith("data: ")){const A=T.trim().substring(6);if(A==="[DONE]")break;try{const W=((x=(k=JSON.parse(A).choices[0])==null?void 0:k.delta)==null?void 0:x.content)||"";E+=W,a.value[t].content=E,i()}catch(M){console.warn("Parse error",M)}}}}}catch(_){a.value[t].content=`å‡ºé”™å•¦: ${_.message}`}finally{h.value=!1,i()}};return(u,t)=>(r(),m("div",Q,[e("div",X,[t[7]||(t[7]=e("span",{class:"chat-title"},"ğŸ¤– AI åŠ©æ‰‹",-1)),e("div",Y,[e("button",{onClick:I,class:"icon-btn",title:"æ¸…é™¤å†å²"},"ğŸ§¹"),e("button",{onClick:t[0]||(t[0]=n=>c.value=!c.value),class:"icon-btn",title:"è®¾ç½®"},"âš™ï¸"),e("button",{onClick:t[1]||(t[1]=n=>u.$emit("close-chat")),class:"icon-btn",title:"é€€å‡ºAI"},"âœ–ï¸")])]),c.value?(r(),m("div",Z,[e("div",ee,[t[8]||(t[8]=e("label",null,"API Endpoint:",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>d.value=n),placeholder:"https://api.deepseek.com/chat/completions"},null,512),[[w,d.value]])]),e("div",te,[t[9]||(t[9]=e("label",null,"API Key:",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>l.value=n),type:"password",placeholder:"sk-..."},null,512),[[w,l.value]])]),e("div",se,[t[10]||(t[10]=e("label",null,"Model:",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>g.value=n),placeholder:"deepseek-chat"},null,512),[[w,g.value]])]),e("button",{onClick:t[5]||(t[5]=n=>c.value=!1),class:"save-btn"},"ä¿å­˜å¹¶è¿”å›")])):(r(),m("div",{key:1,class:"chat-body",ref_key:"chatBody",ref:p},[(r(!0),m(O,null,U(a.value,(n,k)=>(r(),m("div",{key:k,class:S(["message",n.role])},[e("div",ne,$(n.content),1)],2))),128)),h.value?(r(),m("div",ae,t[11]||(t[11]=[e("div",{class:"message-content typing"},"æ­£åœ¨æ€è€ƒ...",-1)]))):D("",!0)],512)),c.value?D("",!0):(r(),m("div",oe,[b(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=n=>o.value=n),onKeydown:z(H(s,["prevent"]),["enter"]),placeholder:"è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...",rows:"1"},null,40,le),[[w,o.value]]),e("button",{onClick:s,disabled:h.value||!o.value.trim()},"å‘é€",8,ie)]))]))}},ce=j(re,[["__scopeId","data-v-51711965"]]),de=["title"],ue={class:"handle-icon"},ve={key:1,class:"info-content"},me={class:"panel-header"},pe=["src"],he={class:"title-wrapper"},ge=["href"],fe={class:"news-header"},_e=["href","target"],be={class:"image-container"},ye=["src","alt"],ke=["innerHTML"],we={class:"panel-footer"},Ie=["href"],Se={__name:"SidePanel",props:{locationInfo:{type:Object,default:()=>({isInDihuan:!1,lonLat:[0,0]})},selectedImage:{type:String,default:""},activeTab:{type:String,default:"info"}},emits:["news-changed","toggle-panel","close-chat"],setup(y,{emit:C}){const c={MAIN_NEWS:"https://cep.henu.edu.cn/zhxw/xyxw.htm"},o=y,h=C,p="./",d=s=>`${p.endsWith("/")?p:`${p}/`}${s}`,l=[{title:"4.22åœ°çƒæ—¥ï¼Œåœ°ç¯é™¢å¼€å±•ç³»åˆ—æ´»åŠ¨",text:"æ˜¥é£æ‹‚ç»¿é‡ï¼Œä¸‡ç‰©ç«èŠ³åã€‚åœ¨ç¬¬56ä¸ªä¸–ç•Œåœ°çƒæ—¥æ¥ä¸´ä¹‹é™…ï¼Œ4æœˆ21æ—¥ä¸Šåˆï¼Œç”±æ²³å—å¤§å­¦ç›¸å…³å•ä½ä¸»åŠï¼Œåœ¨é‡‘æ˜æ ¡åŒºé©¬å¯å¹¿åœºä¸¾è¡Œã€‚å­¦æ ¡ç›¸å…³èŒèƒ½éƒ¨é—¨é¢†å¯¼ï¼Œåœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨å§”å‘˜ï¼Œåœ°ç†ç§‘å­¦å­¦é™¢å…¨ä½“ç­å­æˆå‘˜å’Œå¸ˆç”Ÿä»£è¡¨...",image:"images/åœ°çƒæ—¥æ´»åŠ¨.jpg",href:"https://cep.henu.edu.cn/info/1022/13421.htm"},{title:"åœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨é¦–å±Šå¤§ä¼šå¬å¼€",text:"2025å¹´2æœˆ23æ—¥ï¼Œæ²³å—å¤§å­¦åœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨é¦–å±Šå¤§ä¼šåœ¨æ²³å—å¤§å­¦é‡‘æ˜æ ¡åŒºé”¥å½¢æŠ¥å‘Šå…é¡ºåˆ©å¬å¼€ã€‚ä¸­å›½å·¥ç¨‹é™¢é™¢å£«ã€ç©ºé—´åŸºå‡†å…¨å›½é‡ç‚¹å®éªŒå®¤å­¦æœ¯å¸¦å¤´äººç‹å®¶è€€ç­‰èŒèƒ½éƒ¨é—¨æœ‰å…³é¢†å¯¼...",image:"images/å­¦éƒ¨å¤§ä¼š.png",href:"https://cep.henu.edu.cn/info/1022/12491.htm"},{title:"2023çº§æœ¬ç§‘ç”Ÿå¹´çº§å¤§ä¼šå¬å¼€",text:"ä¸ºåŠ©åŠ›æˆ‘é™¢2023çº§æœ¬ç§‘ç”Ÿå˜æ¸…å­¦æœ¯åŸ¹å…»è·¯å¾„ï¼Œç³»ç»Ÿæå‡ç§‘ç ”ç´ å…»ä¸å®‰å…¨é˜²èŒƒèƒ½åŠ›ï¼Œæ ‘ç«‹ç§‘å­¦çš„å­¦æœ¯å‘å±•ä¸èŒä¸šè§„åˆ’æ„è¯†ï¼Œ5æœˆ29æ—¥ä¸‹åˆï¼Œæˆ‘é™¢äºé‡‘æ˜æ ¡åŒºç»¼åˆæ•™å­¦æ¥¼2306æ•™å®¤å¬å¼€...",image:"images/å¹´çº§å¤§ä¼š.jpg",href:"https://cep.henu.edu.cn/info/1022/14001.htm"}],g={title:"åœ°ç§‘é™¢æ–°é—»",text:"è¯·å°†é¼ æ ‡ç§»åŠ¨åˆ°åœ°ç§‘é™¢åŒºåŸŸ<br>æŸ¥çœ‹æ–°é—»å†…å®¹<br><br>åœ¨å·¦ä¾§åœ°å›¾ä¸­æ”¾å¤§<br>å¯ä»¥æŸ¥çœ‹åœ°ç§‘é™¢çš„ç…§ç‰‡ï¼<br><br>ä¸‹æ–¹è¿˜æœ‰å†…å®¹å“¦ï¼<br>è¯·é¼ æ ‡ä¸‹æ»‘",image:"images/é™¢å¾½.png",href:c.MAIN_NEWS,isExternal:!0},a=v(0),i=F(()=>{if(!o.locationInfo.isInDihuan)return{...g,image:o.selectedImage||d(l[a.value].image)};const s=l[a.value];return{title:s.title,text:s.text,image:o.selectedImage||d(s.image),href:s.href,isExternal:!0}});function I(){a.value=(a.value+1)%l.length,h("news-changed",a.value)}return(s,u)=>(r(),m("div",{class:S(["info-panel",{collapsed:s.isCollapsed,"in-dihuan":o.locationInfo.isInDihuan}])},[e("div",{class:"toggle-handle",onClick:u[0]||(u[0]=t=>s.$emit("toggle-panel")),title:s.isCollapsed?"å±•å¼€é¢æ¿":"æ”¶èµ·é¢æ¿"},[e("span",ue,$(s.isCollapsed?"â—€":"â–¶"),1)],8,de),b(e("div",{class:S(["panel-content",{"no-padding":y.activeTab==="chat"}])},[y.activeTab==="chat"?(r(),G(ce,{key:0,onCloseChat:u[1]||(u[1]=t=>s.$emit("close-chat"))})):(r(),m("div",ve,[e("div",me,[e("img",{src:d("images/é™¢å¾½.png"),class:"logo",alt:"æ²³å—å¤§å­¦åœ°ç†ç§‘å­¦å­¦é™¢Logo"},null,8,pe),e("div",he,[e("a",{href:c.MAIN_NEWS,target:"_blank",class:"main-title"},"åœ°ç§‘é™¢æ–°é—»",8,ge)])]),e("div",fe,[e("a",{href:i.value.href,target:i.value.isExternal?"_blank":"_self"},$(i.value.title),9,_e)]),e("div",be,[e("img",{src:i.value.image,class:"news-image",alt:i.value.title},null,8,ye)]),e("div",{class:"text-content",innerHTML:i.value.text},null,8,ke),e("button",{class:"action-button",onClick:I,title:"åˆ‡æ¢ä¸‹ä¸€æ¡æ–°é—»"}," ç‚¹å‡»ï¼Œæ–°é—»++ "),R(s.$slots,"extra-content",{},void 0),e("div",we,[e("a",{href:c.MAIN_NEWS,target:"_blank"},"æ²³å—å¤§å­¦åœ°ç†ç§‘å­¦å­¦é™¢ï¼",8,Ie)])]))],2),[[J,!s.isCollapsed]])],2))}},xe=j(Se,[["__scopeId","data-v-dd018695"]]);export{xe as default};
