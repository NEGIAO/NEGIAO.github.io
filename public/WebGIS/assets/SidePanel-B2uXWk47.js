import{_ as U,r as o,w as z,c,b as i,d as e,e as j,f as $,v as C,g as F,t as I,h as J,F as L,i as B,n as E,j as R,k as Q,l as X,m as Y,p as Z,q as ee,s as te}from"./index-D0pGHmEW.js";const se={class:"chat-container"},ae={class:"chat-header"},ne={class:"header-controls"},le={key:0,class:"settings-panel"},oe={class:"form-group"},ie={class:"form-group"},re={class:"form-group"},ce=["disabled"],de=["value"],ue={class:"hint"},ve={class:"message-content"},me={key:0,class:"message assistant"},he={key:2,class:"chat-footer"},pe=["onKeydown"],ge=["disabled"],fe={__name:"ChatPanelContent",emits:["close-chat"],setup(S,{emit:N}){const v=o(!1),r=o(""),_=o(!1),p=o(null),g=o(!1),d=o([{id:"deepseek-ai/DeepSeek-V2.5",name:"DeepSeek V2.5 (é»˜è®¤)"}]),b=o("ç‚¹å‡»ğŸ”„å¯è·å–æ›´å¤šæ¨¡å‹"),l=o(localStorage.getItem("llm_endpoint_v3")||"https://api.siliconflow.cn/v1/chat/completions"),n=o(localStorage.getItem("llm_apikey_v3")||"sk-cieoxpimltrmqybxfnqqkrafetvfvxspmpvycggvxsmkboul"),m=o(localStorage.getItem("llm_model_v3")||"deepseek-ai/DeepSeek-V2.5"),a=o([{role:"assistant",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ"}]);z([l,n,m],()=>{localStorage.setItem("llm_endpoint_v3",l.value),localStorage.setItem("llm_apikey_v3",n.value),localStorage.setItem("llm_model_v3",m.value)});const h=()=>{X(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},x=()=>{confirm("ç¡®å®šè¦æ¸…é™¤èŠå¤©å†å²å—ï¼Ÿ")&&(a.value=[{role:"assistant",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ"}])},W=async()=>{if(!n.value){b.value="âŒ è¯·å…ˆå¡«å†™ API Key";return}g.value=!0,b.value="æ­£åœ¨è·å–æ¨¡å‹åˆ—è¡¨...";try{const t=`${l.value.replace(/\/chat\/completions$/,"")}/models`,s=await fetch(t,{method:"GET",headers:{Authorization:`Bearer ${n.value}`}});if(!s.ok)throw new Error(`HTTP ${s.status}`);const f=await s.json();if(f.data&&Array.isArray(f.data))d.value=f.data.filter(u=>u.id).map(u=>({id:u.id,name:u.name||u.id})),b.value=`âœ… å·²åŠ è½½ ${d.value.length} ä¸ªæ¨¡å‹`,!d.value.some(u=>u.id===m.value)&&d.value.length>0&&(m.value=d.value[0].id);else throw new Error("è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸")}catch(y){b.value=`âŒ è·å–å¤±è´¥: ${y.message}`,console.error("è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥:",y)}finally{g.value=!1}},T=async()=>{var s,f,u;if(!r.value.trim()||_.value)return;const y=r.value.trim();a.value.push({role:"user",content:y}),r.value="",_.value=!0,h();const t=a.value.push({role:"assistant",content:""})-1;try{if(!n.value)throw new Error("è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® API Key");const w=await fetch(l.value,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.value}`},body:JSON.stringify({model:m.value,messages:[{role:"system",content:"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„WebGISå¼€å‘åŠ©æ‰‹ï¼Œç²¾é€šVue3, OpenLayers, Cesiumç­‰æŠ€æœ¯ï¼Œå°†è¢«æˆ‘åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œè¯·ä½ ç»™æˆ‘çš„ç½‘é¡µä½¿ç”¨è€…æä¾›å¸®åŠ©ã€‚è¯·ç”¨ç®€æ´æ˜äº†çš„è¯­è¨€å›ç­”ç”¨æˆ·é—®é¢˜ã€‚ä½ å°†è¢«æˆ‘åœ¨WebGISçš„éƒ¨ç½²ä¸­è°ƒç”¨ï¼Œæˆ‘ï¼ˆå¼€å‘è€…ï¼‰çš„ä¿¡æ¯å¦‚ä¸‹ï¼šNEGIAO,GISä¸“ä¸šï¼›æˆ‘çš„è”ç³»æ–¹å¼æ˜¯ï¼š1482918576@qq.comï¼›è¯·åŸºäºè¿™äº›ä¿¡æ¯æä¾›å¯¹ç”¨æˆ·æœ‰é’ˆå¯¹æ€§çš„å¸®åŠ©ã€‚æ³¨æ„ï¼Œæ¥ä¸‹æ¥çš„å¯¹è¯éƒ½æ˜¯ç”¨æˆ·å‘èµ·çš„ï¼š"},...a.value.slice(0,-1).map(k=>({role:k.role,content:k.content}))],stream:!0})});if(!w.ok){const k=await w.json();throw new Error(((s=k.error)==null?void 0:s.message)||"è¯·æ±‚å¤±è´¥")}const K=w.body.getReader(),O=new TextDecoder("utf-8");let A=!1,M="";for(;!A;){const{value:k,done:q}=await K.read();if(A=q,k){const H=O.decode(k,{stream:!0}).split(`
`);for(const D of H)if(D.trim().startsWith("data: ")){const P=D.trim().substring(6);if(P==="[DONE]")break;try{const G=((u=(f=JSON.parse(P).choices[0])==null?void 0:f.delta)==null?void 0:u.content)||"";M+=G,a.value[t].content=M,h()}catch(V){console.warn("Parse error",V)}}}}}catch(w){a.value[t].content=`å‡ºé”™å•¦: ${w.message}`}finally{_.value=!1,h()}};return(y,t)=>(i(),c("div",se,[e("div",ae,[t[7]||(t[7]=e("span",{class:"chat-title"},"ğŸ¤– AI åŠ©æ‰‹",-1)),e("div",ne,[e("button",{onClick:x,class:"icon-btn",title:"æ¸…é™¤å†å²"},"ğŸ§¹"),e("button",{onClick:t[0]||(t[0]=s=>v.value=!v.value),class:"icon-btn",title:"è®¾ç½®"},"âš™ï¸"),e("button",{onClick:t[1]||(t[1]=s=>y.$emit("close-chat")),class:"icon-btn",title:"é€€å‡ºAI"},"âœ–ï¸")])]),v.value?(i(),c("div",le,[e("div",oe,[t[8]||(t[8]=e("label",null,"API Endpoint:",-1)),$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value=s),placeholder:"https://api.deepseek.com/chat/completions"},null,512),[[C,l.value]])]),e("div",ie,[t[9]||(t[9]=e("label",null,"API Key:",-1)),$(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value=s),type:"password",placeholder:"sk-..."},null,512),[[C,n.value]])]),e("div",re,[e("label",null,[t[10]||(t[10]=F("Model: ")),e("button",{onClick:W,class:"refresh-btn",disabled:g.value,title:"åˆ·æ–°æ¨¡å‹åˆ—è¡¨"},I(g.value?"â³":"ğŸ”„"),9,ce)]),$(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>m.value=s),class:"model-select"},[(i(!0),c(L,null,B(d.value,s=>(i(),c("option",{key:s.id,value:s.id},I(s.name||s.id),9,de))),128))],512),[[J,m.value]]),e("small",ue,I(b.value),1)]),e("button",{onClick:t[5]||(t[5]=s=>v.value=!1),class:"save-btn"},"ä¿å­˜å¹¶è¿”å›")])):(i(),c("div",{key:1,class:"chat-body",ref_key:"chatBody",ref:p},[(i(!0),c(L,null,B(a.value,(s,f)=>(i(),c("div",{key:f,class:E(["message",s.role])},[e("div",ve,I(s.content),1)],2))),128)),_.value?(i(),c("div",me,t[11]||(t[11]=[e("div",{class:"message-content typing"},"æ­£åœ¨æ€è€ƒ...",-1)]))):j("",!0)],512)),v.value?j("",!0):(i(),c("div",he,[$(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>r.value=s),onKeydown:R(Q(T,["prevent"]),["enter"]),placeholder:"è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...",rows:"1"},null,40,pe),[[C,r.value]]),e("button",{onClick:T,disabled:_.value||!r.value.trim()},"å‘é€",8,ge)]))]))}},_e=U(fe,[["__scopeId","data-v-8fce3711"]]),be=["title"],ye={class:"handle-icon"},ke={key:1,class:"info-content"},Ie={class:"panel-header"},we=["src"],$e={class:"title-wrapper"},Se=["href"],xe={class:"news-header"},Ce=["href","target"],Ee={class:"image-container"},Ne=["src","alt"],Te=["innerHTML"],Ae={class:"panel-footer"},Me=["href"],De={__name:"SidePanel",props:{locationInfo:{type:Object,default:()=>({isInDihuan:!1,lonLat:[0,0]})},selectedImage:{type:String,default:""},activeTab:{type:String,default:"info"}},emits:["news-changed","toggle-panel","close-chat"],setup(S,{emit:N}){const v={MAIN_NEWS:"https://cep.henu.edu.cn/zhxw/xyxw.htm"},r=S,_=N,p="./",g=a=>`${p.endsWith("/")?p:`${p}/`}${a}`,d=[{title:"4.22åœ°çƒæ—¥ï¼Œåœ°ç¯é™¢å¼€å±•ç³»åˆ—æ´»åŠ¨",text:"æ˜¥é£æ‹‚ç»¿é‡ï¼Œä¸‡ç‰©ç«èŠ³åã€‚åœ¨ç¬¬56ä¸ªä¸–ç•Œåœ°çƒæ—¥æ¥ä¸´ä¹‹é™…ï¼Œ4æœˆ21æ—¥ä¸Šåˆï¼Œç”±æ²³å—å¤§å­¦ç›¸å…³å•ä½ä¸»åŠï¼Œåœ¨é‡‘æ˜æ ¡åŒºé©¬å¯å¹¿åœºä¸¾è¡Œã€‚å­¦æ ¡ç›¸å…³èŒèƒ½éƒ¨é—¨é¢†å¯¼ï¼Œåœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨å§”å‘˜ï¼Œåœ°ç†ç§‘å­¦å­¦é™¢å…¨ä½“ç­å­æˆå‘˜å’Œå¸ˆç”Ÿä»£è¡¨...",image:"images/åœ°çƒæ—¥æ´»åŠ¨.jpg",href:"https://cep.henu.edu.cn/info/1022/13421.htm"},{title:"åœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨é¦–å±Šå¤§ä¼šå¬å¼€",text:"2025å¹´2æœˆ23æ—¥ï¼Œæ²³å—å¤§å­¦åœ°ç†ç§‘å­¦ä¸å·¥ç¨‹å­¦éƒ¨é¦–å±Šå¤§ä¼šåœ¨æ²³å—å¤§å­¦é‡‘æ˜æ ¡åŒºé”¥å½¢æŠ¥å‘Šå…é¡ºåˆ©å¬å¼€ã€‚ä¸­å›½å·¥ç¨‹é™¢é™¢å£«ã€ç©ºé—´åŸºå‡†å…¨å›½é‡ç‚¹å®éªŒå®¤å­¦æœ¯å¸¦å¤´äººç‹å®¶è€€ç­‰èŒèƒ½éƒ¨é—¨æœ‰å…³é¢†å¯¼...",image:"images/å­¦éƒ¨å¤§ä¼š.png",href:"https://cep.henu.edu.cn/info/1022/12491.htm"},{title:"2023çº§æœ¬ç§‘ç”Ÿå¹´çº§å¤§ä¼šå¬å¼€",text:"ä¸ºåŠ©åŠ›æˆ‘é™¢2023çº§æœ¬ç§‘ç”Ÿå˜æ¸…å­¦æœ¯åŸ¹å…»è·¯å¾„ï¼Œç³»ç»Ÿæå‡ç§‘ç ”ç´ å…»ä¸å®‰å…¨é˜²èŒƒèƒ½åŠ›ï¼Œæ ‘ç«‹ç§‘å­¦çš„å­¦æœ¯å‘å±•ä¸èŒä¸šè§„åˆ’æ„è¯†ï¼Œ5æœˆ29æ—¥ä¸‹åˆï¼Œæˆ‘é™¢äºé‡‘æ˜æ ¡åŒºç»¼åˆæ•™å­¦æ¥¼2306æ•™å®¤å¬å¼€...",image:"images/å¹´çº§å¤§ä¼š.jpg",href:"https://cep.henu.edu.cn/info/1022/14001.htm"}],b={title:"åœ°ç§‘é™¢æ–°é—»",text:"è¯·å°†é¼ æ ‡ç§»åŠ¨åˆ°åœ°ç§‘é™¢åŒºåŸŸ<br>æŸ¥çœ‹æ–°é—»å†…å®¹<br><br>åœ¨å·¦ä¾§åœ°å›¾ä¸­æ”¾å¤§<br>å¯ä»¥æŸ¥çœ‹åœ°ç§‘é™¢çš„ç…§ç‰‡ï¼<br><br>ä¸‹æ–¹è¿˜æœ‰å†…å®¹å“¦ï¼<br>è¯·é¼ æ ‡ä¸‹æ»‘",image:"images/é™¢å¾½.png",href:v.MAIN_NEWS,isExternal:!0},l=o(0),n=Y(()=>{if(!r.locationInfo.isInDihuan)return{...b,image:r.selectedImage||g(d[l.value].image)};const a=d[l.value];return{title:a.title,text:a.text,image:r.selectedImage||g(a.image),href:a.href,isExternal:!0}});function m(){l.value=(l.value+1)%d.length,_("news-changed",l.value)}return(a,h)=>(i(),c("div",{class:E(["info-panel",{collapsed:a.isCollapsed,"in-dihuan":r.locationInfo.isInDihuan}])},[e("div",{class:"toggle-handle",onClick:h[0]||(h[0]=x=>a.$emit("toggle-panel")),title:a.isCollapsed?"å±•å¼€é¢æ¿":"æ”¶èµ·é¢æ¿"},[e("span",ye,I(a.isCollapsed?"â—€":"â–¶"),1)],8,be),$(e("div",{class:E(["panel-content",{"no-padding":S.activeTab==="chat"}])},[S.activeTab==="chat"?(i(),ee(_e,{key:0,onCloseChat:h[1]||(h[1]=x=>a.$emit("close-chat"))})):(i(),c("div",ke,[e("div",Ie,[e("img",{src:g("images/é™¢å¾½.png"),class:"logo",alt:"æ²³å—å¤§å­¦åœ°ç†ç§‘å­¦å­¦é™¢Logo"},null,8,we),e("div",$e,[e("a",{href:v.MAIN_NEWS,target:"_blank",class:"main-title"},"åœ°ç§‘é™¢æ–°é—»",8,Se)])]),e("div",xe,[e("a",{href:n.value.href,target:n.value.isExternal?"_blank":"_self"},I(n.value.title),9,Ce)]),e("div",Ee,[e("img",{src:n.value.image,class:"news-image",alt:n.value.title},null,8,Ne)]),e("div",{class:"text-content",innerHTML:n.value.text},null,8,Te),e("button",{class:"action-button",onClick:m,title:"åˆ‡æ¢ä¸‹ä¸€æ¡æ–°é—»"}," ç‚¹å‡»ï¼Œæ–°é—»++ "),te(a.$slots,"extra-content",{},void 0),e("div",Ae,[e("a",{href:v.MAIN_NEWS,target:"_blank"},"æ²³å—å¤§å­¦åœ°ç†ç§‘å­¦å­¦é™¢ï¼",8,Me)])]))],2),[[Z,!a.isCollapsed]])],2))}},je=U(De,[["__scopeId","data-v-dd018695"]]);export{je as default};
